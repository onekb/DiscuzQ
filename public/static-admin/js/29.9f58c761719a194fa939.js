(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"57Wb":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(i("QbLZ"));i("lL+3");var s=r(i("Xz3T"));function r(e){return e&&e.__esModule?e:{default:e}}t.default=(0,a.default)({name:"reply-review-view"},s.default)},CKnL:function(e,t,i){"use strict";i.r(t);var a=i("i7/w"),s=i.n(a);const r=s.a.prototype.$isServer,n=(r||Number(document.documentMode),!r&&document.addEventListener?function(e,t,i){e&&t&&i&&e.addEventListener(t,i,!1)}:function(e,t,i){e&&t&&i&&e.attachEvent("on"+t,i)}),o=!r&&document.removeEventListener?function(e,t,i){e&&t&&e.removeEventListener(t,i,!1)}:function(e,t,i){e&&t&&e.detachEvent("on"+t,i)};Object.prototype.hasOwnProperty;function l(e){let t=!1;return function(...i){t||(t=!0,window.requestAnimationFrame(a=>{e.apply(this,i),t=!1}))}}const c={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},u=!s.a.prototype.$isServer&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel";var d={name:"elImageViewer",props:{urlList:{type:Array,default:()=>[]},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:()=>{}},onClose:{type:Function,default:()=>{}},initialIndex:{type:Number,default:0}},data(){return{index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:c.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle(){return this.urlList.length<=1},isFirst(){return 0===this.index},isLast(){return this.index===this.urlList.length-1},currentImg(){return this.urlList[this.index]},imgStyle(){const{scale:e,deg:t,offsetX:i,offsetY:a,enableTransition:s}=this.transform,r={transform:`scale(${e}) rotate(${t}deg)`,transition:s?"transform .3s":"","margin-left":i+"px","margin-top":a+"px"};return this.mode===c.CONTAIN&&(r.maxWidth=r.maxHeight="100%"),r}},watch:{index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg(e){this.$nextTick(e=>{this.$refs.img[0].complete||(this.loading=!0)})}},methods:{hide(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall(){this._keyDownHandler=l(e=>{switch(e.keyCode){case 27:this.hide();break;case 32:this.toggleMode();break;case 37:this.prev();break;case 38:this.handleActions("zoomIn");break;case 39:this.next();break;case 40:this.handleActions("zoomOut")}}),this._mouseWheelHandler=l(e=>{(e.wheelDelta?e.wheelDelta:-e.detail)>0?this.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):this.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1})}),n(document,"keydown",this._keyDownHandler),n(document,u,this._mouseWheelHandler)},deviceSupportUninstall(){o(document,"keydown",this._keyDownHandler),o(document,u,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad(e){this.loading=!1},handleImgError(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown(e){if(this.loading||0!==e.button)return;const{offsetX:t,offsetY:i}=this.transform,a=e.pageX,s=e.pageY;this._dragHandler=l(e=>{this.transform.offsetX=t+e.pageX-a,this.transform.offsetY=i+e.pageY-s}),n(document,"mousemove",this._dragHandler),n(document,"mouseup",e=>{o(document,"mousemove",this._dragHandler)}),e.preventDefault()},reset(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode(){if(this.loading)return;const e=Object.keys(c),t=(Object.values(c).indexOf(this.mode)+1)%e.length;this.mode=c[e[t]],this.reset()},prev(){if(this.isFirst&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index-1+e)%e},next(){if(this.isLast&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index+1)%e},handleActions(e,t={}){if(this.loading)return;const{zoomRate:i,rotateDeg:a,enableTransition:s}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...t},{transform:r}=this;switch(e){case"zoomOut":r.scale>.2&&(r.scale=parseFloat((r.scale-i).toFixed(3)));break;case"zoomIn":r.scale=parseFloat((r.scale+i).toFixed(3));break;case"clocelise":r.deg+=a;break;case"anticlocelise":r.deg-=a}r.enableTransition=s}},mounted(){this.deviceSupportInstall(),this.$refs["el-image-viewer__wrapper"].focus()}},h=i("KHd+"),m=Object(h.a)(d,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"viewer-fade"}},[i("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":e.zIndex},attrs:{tabindex:"-1"}},[i("div",{staticClass:"el-image-viewer__mask"}),e._v(" "),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:e.hide}},[i("i",{staticClass:"el-icon-circle-close"})]),e._v(" "),e.isSingle?e._e():[i("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},on:{click:e.prev}},[i("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},on:{click:e.next}},[i("i",{staticClass:"el-icon-arrow-right"})])],e._v(" "),i("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[i("div",{staticClass:"el-image-viewer__actions__inner"},[i("i",{staticClass:"el-icon-zoom-out",on:{click:function(t){return e.handleActions("zoomOut")}}}),e._v(" "),i("i",{staticClass:"el-icon-zoom-in",on:{click:function(t){return e.handleActions("zoomIn")}}}),e._v(" "),i("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),i("i",{class:e.mode.icon,on:{click:e.toggleMode}}),e._v(" "),i("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),i("i",{staticClass:"el-icon-refresh-left",on:{click:function(t){return e.handleActions("anticlocelise")}}}),e._v(" "),i("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.handleActions("clocelise")}}})])]),e._v(" "),i("div",{staticClass:"el-image-viewer__canvas"},e._l(e.urlList,(function(t,a){return a===e.index?i("img",{key:t,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img",style:e.imgStyle,attrs:{src:e.currentImg},on:{load:e.handleImgLoad,error:e.handleImgError,mousedown:e.handleMouseDown}}):e._e()})),0)],2)])}),[],!1,null,null,null);t.default=m.exports},FCu8:function(e,t,i){"use strict";i.r(t);var a=i("57Wb"),s=i.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return a[e]}))}(r);t.default=s.a},Skey:function(e,t,i){"use strict";i.r(t);var a=i("xEPy"),s=i("FCu8");for(var r in s)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(r);var n=i("KHd+"),o=Object(n.a)(s.default,a.a,a.b,!1,null,null,null);t.default=o.exports},Xz3T:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=u(i("4gYi")),s=u(i("Dt3C")),r=u(i("rWG0")),n=u(i("7qpD")),o=u(i("VVfg")),l=u(i("CKnL")),c=u(i("6NK7"));function u(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{searchUserName:"",keyWords:"",showSensitiveWords:!1,pageOptions:[{value:10,label:"每页显示10条"},{value:20,label:"每页显示20条"},{value:30,label:"每页显示30条"}],pageSelect:10,searchReview:[{value:0,label:"未审核"},{value:2,label:"已忽略"}],searchReviewSelect:0,categoriesList:[],categoriesListSelect:"",searchTime:[{value:1,label:"全部"},{value:2,label:"最近一周"},{value:3,label:"最近一个月"},{value:4,label:"最近三个月"}],searchTimeSelect:1,relativeTime:["",""],reasonForOperation:[{value:"无",label:"无"},{value:"广告/SPAM",label:"广告/SPAM"},{value:"恶意灌水",label:"恶意灌水"},{value:"违规内容",label:"违规内容"},{value:"文不对题",label:"文不对题"},{value:"重复发帖",label:"重复发帖"},{value:"我很赞同",label:"我很赞同"},{value:"精品文章",label:"精品文章"},{value:"原创内容",label:"原创内容"},{value:"其他",label:"其他"}],reasonForOperationSelect:1,appleAll:!1,themeList:[],currentPaga:1,total:0,pageCount:1,ignoreStatus:!0,submitForm:[],showViewer:!1,url:[],subLoading:!1,btnLoading:0}},methods:{titleIcon:function(e){return c.default.titleIcon(e)},imgShowClick:function(e,t){var i=this;this.url=[];var a=[];e.forEach((function(e){a.push(e._data.url)})),this.url.push(a[t]),a.forEach((function(e,a){a>t&&i.url.push(e)})),a.forEach((function(e,a){a<t&&i.url.push(e)})),this.showViewer=!0},closeViewer:function(){this.showViewer=!1},handleSelectionChange:function(e){this.multipleSelection=e,this.multipleSelection.length>=1?this.deleteStatus=!1:this.deleteStatus=!0},reasonForOperationChange:function(e,t){this.submitForm[t].attributes.message=e},handleCurrentChange:function(e){document.getElementsByClassName("index-main-con__main")[0].scrollTop=0,o.default.setLItem("currentPag",e),this.currentPaga=e,this.getPostsList(e)},postSearch:function(){this.ignoreStatus=2!==this.searchReviewSelect,this.currentPaga=1,this.getPostsList()},searchTimeChange:function(e){var t=new Date,i=new Date;switch(this.relativeTime=[],e){case 1:this.relativeTime.push("","");break;case 2:i.setTime(i.getTime()-6048e5),this.relativeTime.push(this.formatDate(t),this.formatDate(i));break;case 3:i.setTime(i.getTime()-2592e6),this.relativeTime.push(this.formatDate(t),this.formatDate(i));break;case 4:i.setTime(i.getTime()-7776e6),this.relativeTime.push(this.formatDate(t),this.formatDate(i));break;default:this.$message.error("搜索日期选择错误，请重新选择！或 刷新页面（F5）")}},submitClick:function(){this.subLoading=!0,this.patchPostsBatch(this.submitForm)},radioChange:function(e,t){switch(e){case 0:this.submitForm[t].attributes.isApproved=1;break;case 1:this.submitForm[t].attributes.isDeleted=!0;break;case 2:this.submitForm[t].attributes.isApproved=2}},allOperationsSubmit:function(e){var t=this;switch(this.btnLoading=e,e){case 1:this.submitForm.forEach((function(e,i){t.submitForm[i].attributes.isApproved=1}));break;case 2:this.submitForm.forEach((function(e,i){t.submitForm[i].attributes.isDeleted=!0}));break;case 3:this.submitForm.forEach((function(e,i){t.submitForm[i].attributes.isApproved=2}))}this.patchPostsBatch(this.submitForm)},singleOperationSubmit:function(e,t,i,a){var s={type:"posts",attributes:{}};switch(e){case 1:s.attributes.isApproved=1,s.attributes.message=this.submitForm[a].attributes.message,this.patchPosts(s,i);break;case 2:s.attributes.isDeleted=!0,s.attributes.message=this.submitForm[a].attributes.message,this.patchPosts(s,i);break;case 3:s.attributes.isApproved=2,s.attributes.message=this.submitForm[a].attributes.message,this.patchPosts(s,i)}},viewClick:function(e){var t=this.$router.resolve({path:"/topic/index?id="+e});window.open(t.href,"_blank")},editClick:function(e,t){var i=this.$router.resolve({path:"/reply-to-topic/"+e+"/"+t,query:{edit:"reply"}});window.open(i.href,"_blank")},formatDate:function(e){return this.$dayjs(e).format("YYYY-MM-DD HH:mm")},getPostsList:function(e){var t=this;this.appFetch({url:"posts",method:"get",data:{include:["user","thread","thread.category","thread.firstPost","images"],"filter[isDeleted]":"no","filter[username]":this.searchUserName,"page[number]":e,"page[size]":this.pageSelect,"filter[q]":this.keyWords,"filter[isApproved]":this.searchReviewSelect,"filter[createdAtBegin]":this.relativeTime[1],"filter[createdAtEnd]":this.relativeTime[0],"filter[categoryId]":this.categoriesListSelect,"filter[highlight]":this.showSensitiveWords?"yes":"no",sort:"-updatedAt"}}).then((function(e){e.errors?t.$message.error(e.errors[0].code):(t.themeList=[],t.submitForm=[],t.themeList=e.readdata,t.total=e.meta.postCount,t.pageCount=e.meta.pageCount,t.themeList.forEach((function(e,i){t.submitForm.push({Select:"无",radio:"",type:"posts",id:e._data.id,attributes:{isApproved:0,isDeleted:!1,message:""}})})))})).catch((function(e){}))},getCategories:function(){var e=this;this.appFetch({url:"categories",method:"get",data:{}}).then((function(t){t.errors?e.$message.error(t.errors[0].code):(e.categoriesList=[],t.data.forEach((function(t,i){e.categoriesList.push({name:t.attributes.name,id:t.id})})))})).catch((function(e){}))},patchPostsBatch:function(e){var t=this;this.appFetch({url:"postsBatch",method:"patch",data:{data:e}}).then((function(e){t.subLoading=!1,t.btnLoading=0,e.errors?t.$message.error(e.errors[0].code):e.meta&&e.data?t.$message.error("操作失败！"):(t.getPostsList(Number(o.default.getLItem("currentPag"))||1),t.$message({message:"操作成功",type:"success"}))})).catch((function(e){}))},patchPosts:function(e,t){var i=this;this.appFetch({url:"posts",method:"patch",splice:"/"+t,data:{data:e}}).then((function(e){i.subLoading=!1,i.btnLoading=0,e.errors?i.$message.error(e.errors[0].code):(i.getPostsList(Number(o.default.getLItem("currentPag"))||1),i.$message({message:"操作成功",type:"success"}))})).catch((function(e){}))}},created:function(){this.getCategories(),this.getPostsList(Number(o.default.getLItem("currentPag"))||1)},components:{Card:a.default,ContArrange:s.default,Page:r.default,tableNoList:n.default,ElImageViewer:l.default}}},xEPy:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"reply-review-box"},[i("div",{staticClass:"cont-review-header"},[i("div",{staticClass:"cont-review-header__lf"},[i("div",[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("用户名：")]),e._v(" "),i("el-input",{attrs:{size:"medium",placeholder:"搜索用户名",clearable:""},model:{value:e.searchUserName,callback:function(t){e.searchUserName=t},expression:"searchUserName"}})],1),e._v(" "),i("div",[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("每页显示：")]),e._v(" "),i("el-select",{attrs:{size:"medium",placeholder:"选择每页显示"},model:{value:e.pageSelect,callback:function(t){e.pageSelect=t},expression:"pageSelect"}},e._l(e.pageOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]),e._v(" "),i("div",{staticClass:"cont-review-header__rt"},[i("div",[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("内容包含：")]),e._v(" "),i("el-input",{staticClass:"content-contains-input",attrs:{size:"medium",clearable:"",placeholder:"搜索关键词"},model:{value:e.keyWords,callback:function(t){e.keyWords=t},expression:"keyWords"}}),e._v(" "),i("el-checkbox",{model:{value:e.showSensitiveWords,callback:function(t){e.showSensitiveWords=t},expression:"showSensitiveWords"}},[e._v("显示敏感词")])],1),e._v(" "),i("div",{staticClass:"cont-review-header__rt-search"},[i("span",{staticClass:"cont-review-header__lf-title"},[e._v("搜索范围：")]),e._v(" "),i("el-select",{attrs:{size:"medium",placeholder:"选择审核状态"},model:{value:e.searchReviewSelect,callback:function(t){e.searchReviewSelect=t},expression:"searchReviewSelect"}},e._l(e.searchReview,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "),i("el-select",{attrs:{size:"medium",clearable:"",placeholder:"选择搜索分类"},model:{value:e.categoriesListSelect,callback:function(t){e.categoriesListSelect=t},expression:"categoriesListSelect"}},e._l(e.categoriesList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),e._v(" "),i("el-select",{attrs:{size:"medium",placeholder:"选择搜索时间"},on:{change:e.searchTimeChange},model:{value:e.searchTimeSelect,callback:function(t){e.searchTimeSelect=t},expression:"searchTimeSelect"}},e._l(e.searchTime,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.postSearch}},[e._v("搜索")])],1)])]),e._v(" "),i("div",{staticClass:"cont-review-table"},[e._l(e.themeList,(function(t,a){return i("ContArrange",{key:t._data.id,attrs:{replyBy:t.user?t.user._data.username:"该用户被删除",themeName:t.thread._data.isLongArticle?t.thread._data.title:t.thread.firstPost._data.content,titleIcon:e.titleIcon(t.thread._data),finalPost:e.formatDate(t._data.updatedAt),ip:t._data.ip,userId:t.user?t.user._data.id:"该用户被删除"}},[i("div",{staticClass:"cont-review-table__side",attrs:{slot:"side"},slot:"side"},[i("el-radio-group",{on:{change:function(t){return e.radioChange(t,a)}},model:{value:e.submitForm[a].radio,callback:function(t){e.$set(e.submitForm[a],"radio",t)},expression:"submitForm[index].radio"}},[i("el-radio",{attrs:{label:0}},[e._v("通过")]),e._v(" "),i("el-radio",{attrs:{label:1}},[e._v("删除")]),e._v(" "),2!==t._data.isApproved?i("el-radio",{attrs:{label:2,disabled:2===t._data.isApproved}},[e._v("忽略")]):e._e()],1)],1),e._v(" "),i("div",{staticClass:"cont-review-table__main",attrs:{slot:"main"},slot:"main"},[i("a",{staticClass:"cont-review-table__main__cont-text",attrs:{href:"/topic/index?id="+t.thread._data.id,target:"_blank"},domProps:{innerHTML:e._s(t._data.contentHtml)}}),e._v(" "),i("div",{staticClass:"cont-review-table__main__cont-imgs"},e._l(t.images,(function(a,s){return i("p",{key:s,staticClass:"cont-review-table__main__cont-imgs-p"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:a._data.thumbUrl,expression:"item._data.thumbUrl"}],attrs:{alt:a._data.fileName},on:{click:function(i){return e.imgShowClick(t.images,s)}}})])})),0)]),e._v(" "),i("div",{staticClass:"cont-review-table__footer",attrs:{slot:"footer"},slot:"footer"},[i("div",{staticClass:"cont-review-table__footer__lf"},[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.singleOperationSubmit(1,t.thread.category._data.id,t._data.id,a)}}},[e._v("通过")]),e._v(" "),i("i"),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.singleOperationSubmit(2,t.thread.category._data.id,t._data.id,a)}}},[e._v("删除")]),e._v(" "),i("i"),e._v(" "),2!==t._data.isApproved?i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.singleOperationSubmit(3,t.thread.category._data.id,t._data.id,a)}}},[e._v("忽略")]):e._e()],1),e._v(" "),i("div",{staticClass:"cont-review-table__footer__rt"},[i("span",[e._v("操作理由：")]),e._v(" "),i("el-input",{attrs:{size:"medium",clearable:""},model:{value:e.submitForm[a].attributes.message,callback:function(t){e.$set(e.submitForm[a].attributes,"message",t)},expression:"submitForm[index].attributes.message"}}),e._v(" "),i("el-select",{attrs:{size:"medium",placeholder:"选择操作理由"},on:{change:function(t){return e.reasonForOperationChange(t,a)}},model:{value:e.submitForm[a].Select,callback:function(t){e.$set(e.submitForm[a],"Select",t)},expression:"submitForm[index].Select"}},e._l(e.reasonForOperation,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),i("div",{staticClass:"cont-review-table__footer__bottom"},[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.viewClick(t.thread._data.id)}}},[e._v("查看")])],1)])])})),e._v(" "),e.showViewer?i("el-image-viewer",{attrs:{"on-close":e.closeViewer,"url-list":e.url}}):e._e(),e._v(" "),i("tableNoList",{directives:[{name:"show",rawName:"v-show",value:e.themeList.length<1,expression:"themeList.length < 1"}]}),e._v(" "),e.pageCount>1?i("Page",{attrs:{"current-page":e.currentPaga,"page-size":e.pageSelect,total:e.total},on:{"current-change":e.handleCurrentChange}}):e._e()],2),e._v(" "),i("div",{staticClass:"cont-review-footer footer-btn"},[i("el-button",{attrs:{size:"small",type:"primary",loading:e.subLoading},on:{click:e.submitClick}},[e._v("提交")]),e._v(" "),i("el-button",{attrs:{type:"text",loading:1===e.btnLoading},on:{click:function(t){return e.allOperationsSubmit(1)}}},[e._v("全部通过")]),e._v(" "),i("el-button",{attrs:{type:"text",loading:2===e.btnLoading},on:{click:function(t){return e.allOperationsSubmit(2)}}},[e._v("全部删除")]),e._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:e.ignoreStatus,expression:"ignoreStatus"}],attrs:{type:"text",loading:3===e.btnLoading},on:{click:function(t){return e.allOperationsSubmit(3)}}},[e._v("全部忽略")])],1)])},s=[]}}]);