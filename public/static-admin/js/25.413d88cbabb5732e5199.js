(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{"+54Z":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(a("QbLZ")),s=n(a("RRYP"));function n(e){return e&&e.__esModule?e:{default:e}}a("lL+3"),t.default=(0,i.default)({name:"latestReplyView"},s.default)},"1Wo1":function(e,t,a){"use strict";a.r(t);var i=a("+54Z"),s=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t.default=s.a},CKnL:function(e,t,a){"use strict";a.r(t);var i=a("i7/w"),s=a.n(i);const n=s.a.prototype.$isServer,r=(n||Number(document.documentMode),!n&&document.addEventListener?function(e,t,a){e&&t&&a&&e.addEventListener(t,a,!1)}:function(e,t,a){e&&t&&a&&e.attachEvent("on"+t,a)}),l=!n&&document.removeEventListener?function(e,t,a){e&&t&&e.removeEventListener(t,a,!1)}:function(e,t,a){e&&t&&e.detachEvent("on"+t,a)};Object.prototype.hasOwnProperty;function o(e){let t=!1;return function(...a){t||(t=!0,window.requestAnimationFrame(i=>{e.apply(this,a),t=!1}))}}const c={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},d=!s.a.prototype.$isServer&&window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel";var h={name:"elImageViewer",props:{urlList:{type:Array,default:()=>[]},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:()=>{}},onClose:{type:Function,default:()=>{}},initialIndex:{type:Number,default:0}},data(){return{index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:c.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle(){return this.urlList.length<=1},isFirst(){return 0===this.index},isLast(){return this.index===this.urlList.length-1},currentImg(){return this.urlList[this.index]},imgStyle(){const{scale:e,deg:t,offsetX:a,offsetY:i,enableTransition:s}=this.transform,n={transform:`scale(${e}) rotate(${t}deg)`,transition:s?"transform .3s":"","margin-left":a+"px","margin-top":i+"px"};return this.mode===c.CONTAIN&&(n.maxWidth=n.maxHeight="100%"),n}},watch:{index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg(e){this.$nextTick(e=>{this.$refs.img[0].complete||(this.loading=!0)})}},methods:{hide(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall(){this._keyDownHandler=o(e=>{switch(e.keyCode){case 27:this.hide();break;case 32:this.toggleMode();break;case 37:this.prev();break;case 38:this.handleActions("zoomIn");break;case 39:this.next();break;case 40:this.handleActions("zoomOut")}}),this._mouseWheelHandler=o(e=>{(e.wheelDelta?e.wheelDelta:-e.detail)>0?this.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):this.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1})}),r(document,"keydown",this._keyDownHandler),r(document,d,this._mouseWheelHandler)},deviceSupportUninstall(){l(document,"keydown",this._keyDownHandler),l(document,d,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad(e){this.loading=!1},handleImgError(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown(e){if(this.loading||0!==e.button)return;const{offsetX:t,offsetY:a}=this.transform,i=e.pageX,s=e.pageY;this._dragHandler=o(e=>{this.transform.offsetX=t+e.pageX-i,this.transform.offsetY=a+e.pageY-s}),r(document,"mousemove",this._dragHandler),r(document,"mouseup",e=>{l(document,"mousemove",this._dragHandler)}),e.preventDefault()},reset(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode(){if(this.loading)return;const e=Object.keys(c),t=(Object.values(c).indexOf(this.mode)+1)%e.length;this.mode=c[e[t]],this.reset()},prev(){if(this.isFirst&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index-1+e)%e},next(){if(this.isLast&&!this.infinite)return;const e=this.urlList.length;this.index=(this.index+1)%e},handleActions(e,t={}){if(this.loading)return;const{zoomRate:a,rotateDeg:i,enableTransition:s}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...t},{transform:n}=this;switch(e){case"zoomOut":n.scale>.2&&(n.scale=parseFloat((n.scale-a).toFixed(3)));break;case"zoomIn":n.scale=parseFloat((n.scale+a).toFixed(3));break;case"clocelise":n.deg+=i;break;case"anticlocelise":n.deg-=i}n.enableTransition=s}},mounted(){this.deviceSupportInstall(),this.$refs["el-image-viewer__wrapper"].focus()}},u=a("KHd+"),m=Object(u.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"viewer-fade"}},[a("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":e.zIndex},attrs:{tabindex:"-1"}},[a("div",{staticClass:"el-image-viewer__mask"}),e._v(" "),a("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:e.hide}},[a("i",{staticClass:"el-icon-circle-close"})]),e._v(" "),e.isSingle?e._e():[a("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},on:{click:e.prev}},[a("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),a("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},on:{click:e.next}},[a("i",{staticClass:"el-icon-arrow-right"})])],e._v(" "),a("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[a("div",{staticClass:"el-image-viewer__actions__inner"},[a("i",{staticClass:"el-icon-zoom-out",on:{click:function(t){return e.handleActions("zoomOut")}}}),e._v(" "),a("i",{staticClass:"el-icon-zoom-in",on:{click:function(t){return e.handleActions("zoomIn")}}}),e._v(" "),a("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),a("i",{class:e.mode.icon,on:{click:e.toggleMode}}),e._v(" "),a("i",{staticClass:"el-image-viewer__actions__divider"}),e._v(" "),a("i",{staticClass:"el-icon-refresh-left",on:{click:function(t){return e.handleActions("anticlocelise")}}}),e._v(" "),a("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.handleActions("clocelise")}}})])]),e._v(" "),a("div",{staticClass:"el-image-viewer__canvas"},e._l(e.urlList,(function(t,i){return i===e.index?a("img",{key:t,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img",style:e.imgStyle,attrs:{src:e.currentImg},on:{load:e.handleImgLoad,error:e.handleImgError,mousedown:e.handleMouseDown}}):e._e()})),0)],2)])}),[],!1,null,null,null);t.default=m.exports},"KHd+":function(e,t,a){"use strict";function i(e,t,a,i,s,n,r,l){var o,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=a,c._compiled=!0),i&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),r?(o=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},c._ssrRegister=o):s&&(o=l?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(c.functional){c._injectStyles=o;var d=c.render;c.render=function(e,t){return o.call(t),d(e,t)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,o):[o]}return{exports:e,options:c}}a.d(t,"a",(function(){return i}))},RRYP:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(a("Dt3C")),s=c(a("7qpD")),n=c(a("rWG0")),r=c(a("CKnL")),l=c(a("VVfg")),o=c(a("6NK7"));function c(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},searchData:{pageSelect:"10",themeAuthor:"",themeKeyWords:"",dataValue:["",""]},checkAll:!1,checkAllNum:0,themeListAll:[],checkedTheme:[],isIndeterminate:!1,themeList:[],currentPag:1,total:0,pageCount:1,showViewer:!1,subLoading:!1}},methods:{searchClick:function(){this.searchData.dataValue=null==this.searchData.dataValue?["",""]:this.searchData.dataValue,this.currentPag=1,this.getPostsList(1)},formatDate:function(e){return this.$dayjs(e).format("YYYY-MM-DD HH:mm")},handleCheckAllChange:function(e){this.checkedTheme=e?this.themeListAll:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e,t,a){var i=this.checkedTheme.length;this.checkAll=i===this.themeListAll.length,this.isIndeterminate=i>0&&i<this.themeListAll.length},handleCurrentChange:function(e){document.getElementsByClassName("index-main-con__main")[0].scrollTop=0,this.isIndeterminate=!1,this.currentPag=e,this.checkAll=!1,this.getPostsList(e)},deleteAllClick:function(){this.subLoading=!0;var e=[];this.checkedTheme.forEach((function(t){e.push({id:t,attributes:{isDeleted:!0}})})),this.deletedPostsBatch(e)},imgShowClick:function(e,t){var a=this;this.url=[];var i=[];e.forEach((function(e){i.push(e._data.url)})),this.url.push(i[t]),i.forEach((function(e,i){i>t&&a.url.push(e)})),i.forEach((function(e,i){i<t&&a.url.push(e)})),this.showViewer=!0},closeViewer:function(){this.showViewer=!1},singleOperationSubmit:function(e,t,a){switch(e){case 1:this.deletedPosts(t);break;case 2:var i=this.$router.resolve({path:"/reply-to-topic/"+a+"/"+t,query:{edit:"reply"}});window.open(i.href,"_blank");break;default:this.$message.error("系统错误，请刷新页面")}},titleIcon:function(e){return o.default.titleIcon(e)},getPostsList:function(e){var t=this,a=this.searchData;this.appFetch({url:"posts",method:"get",data:{include:["user","thread","thread.category","thread.firstPost","images"],"filter[isDeleted]":"no","filter[isApproved]":"1","filter[username]":a.themeAuthor,"page[number]":e,"page[size]":a.pageSelect,"filter[q]":a.themeKeyWords,"filter[createdAtBegin]":a.dataValue[0],"filter[createdAtEnd]":a.dataValue[1],sort:"-createdAt"}}).then((function(e){e.errors?t.$message.error(e.errors[0].code):(t.themeList=e.readdata,t.total=e.meta.postCount,t.pageCount=e.meta.pageCount,t.themeListAll=[],t.themeList.forEach((function(e,a){t.themeListAll.push(e._data.id)})))})).catch((function(e){}))},deletedPostsBatch:function(e){var t=this;this.appFetch({url:"postsBatch",method:"PATCH",data:{data:e}}).then((function(e){t.subLoading=!1,e.meta?e.meta.forEach((function(e,a){setTimeout((function(){t.$message.error(e.code)}),500*(a+1))})):(t.getPostsList(Number(l.default.getLItem("currentPag"))||1),t.$message({message:"操作成功",type:"success"}),t.isIndeterminate=!1,t.checkAll=!1)})).catch((function(e){}))},deletedPosts:function(e){var t=this;this.appFetch({url:"posts",method:"patch",splice:"/"+e,data:{data:{attributes:{isDeleted:!0}}}}).then((function(e){e.errors?t.$message.error(e.errors[0].code):(t.getPostsList(Number(l.default.getLItem("currentPag"))||1),t.$message({message:"操作成功",type:"success"}))}))}},created:function(){this.currentPag=Number(l.default.getLItem("currentPag"))||1,this.getPostsList(Number(l.default.getLItem("currentPag"))||1)},components:{ContArrange:i.default,tableNoList:s.default,ElImageViewer:r.default,Page:n.default}}},Y2SN:function(e,t,a){"use strict";a.r(t);var i=a("yKjd"),s=a("1Wo1");for(var n in s)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(n);var r=a("KHd+"),l=Object(r.a)(s.default,i.a,i.b,!1,null,null,null);t.default=l.exports},yKjd:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return s}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"latest-reply-box"},[a("div",{staticClass:"latest-reply-header"},[a("div",{staticClass:"latest-reply-header_top condition-box"},[a("div",{staticClass:"latest-reply-header_condition latest-reply-header_condition-lf"},[a("span",{staticClass:"latest-reply-header_condition-title"},[e._v("作者：")]),e._v(" "),a("el-input",{attrs:{size:"medium",placeholder:"搜索作者",clearable:""},model:{value:e.searchData.themeAuthor,callback:function(t){e.$set(e.searchData,"themeAuthor",t)},expression:"searchData.themeAuthor"}})],1),e._v(" "),a("div",{staticClass:"latest-reply-header_condition"},[a("span",{staticClass:"latest-reply-header_condition-title"},[e._v("内容包含：")]),e._v(" "),a("el-input",{attrs:{size:"medium",placeholder:"搜索内容包含",clearable:""},model:{value:e.searchData.themeKeyWords,callback:function(t){e.$set(e.searchData,"themeKeyWords",t)},expression:"searchData.themeKeyWords"}})],1)]),e._v(" "),a("div",{staticClass:"latest-reply-header_bottom condition-box"},[a("div",{staticClass:"latest-reply-header_condition condition-time"},[a("span",{staticClass:"latest-reply-header_condition-title"},[e._v("发布时间：")]),e._v(" "),a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"],"picker-options":e.pickerOptions},model:{value:e.searchData.dataValue,callback:function(t){e.$set(e.searchData,"dataValue",t)},expression:"searchData.dataValue"}}),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.searchClick}},[e._v("搜索")])],1)])]),e._v(" "),a("div",{staticClass:"latest-reply-theme"},[a("div",{staticClass:"latest-reply-theme__table"},[a("div",{staticClass:"latest-reply-theme__table-header"},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}}),e._v(" "),a("p",{staticClass:"latest-reply-theme__table-header__title"},[e._v("回复列表")])],1),e._v(" "),e._l(e.themeList,(function(t,i){return a("ContArrange",{key:t._data.id,attrs:{replyBy:t.user?t.user._data.username:"该用户被删除",themeName:1===t.thread._data.type?t.thread._data.title:t.thread.firstPost._data.content,titleIcon:e.titleIcon(t.thread._data),finalPost:e.formatDate(t._data.updatedAt),userId:t.user?t.user._data.id:"该用户被删除"}},[a("div",{staticClass:"latest-reply-theme__table-side",attrs:{slot:"side"},slot:"side"},[a("el-checkbox",{attrs:{label:t._data.id},on:{change:function(t){return e.handleCheckedCitiesChange()}},model:{value:e.checkedTheme,callback:function(t){e.checkedTheme=t},expression:"checkedTheme"}})],1),e._v(" "),a("div",{staticClass:"latest-reply-theme__table-main",attrs:{slot:"main"},slot:"main"},[a("a",{staticClass:"latest-reply-theme__table-main__cont-text",attrs:{href:"/topic/index?id="+t.thread._data.id,target:"_blank"},domProps:{innerHTML:e._s(t._data.contentHtml)}}),e._v(" "),a("div",{staticClass:"latest-reply-theme__table-main__cont-imgs"},e._l(t.images,(function(i,s){return a("p",{key:s,staticClass:"latest-reply-theme__table-main__cont-imgs-p"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy",value:i._data.thumbUrl,expression:"item._data.thumbUrl"}],attrs:{alt:i._data.fileName},on:{click:function(a){return e.imgShowClick(t.images,s)}}})])})),0)]),e._v(" "),a("div",{staticClass:"latest-reply-theme__table-footer",attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"latest-reply-theme__table-footer__lf"},[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.singleOperationSubmit(1,t._data.id)}}},[e._v("删除")])],1)])])})),e._v(" "),e.showViewer?a("el-image-viewer",{attrs:{"on-close":e.closeViewer,"url-list":e.url}}):e._e(),e._v(" "),a("tableNoList",{directives:[{name:"show",rawName:"v-show",value:e.themeList.length<1,expression:"themeList.length < 1"}]}),e._v(" "),e.pageCount>1?a("Page",{attrs:{"current-page":e.currentPag,"page-size":parseInt(e.searchData.pageSelect),total:e.total},on:{"current-change":e.handleCurrentChange}}):e._e()],2)]),e._v(" "),a("div",{staticClass:"latest-reply-footer"},[a("el-button",{attrs:{size:"small",type:"primary",loading:e.subLoading},on:{click:e.deleteAllClick}},[e._v("删除")])],1)])},s=[]}}]);