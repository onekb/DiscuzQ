(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1128:function(e,t,n){"use strict";var r=n(12),o=n(109)(6),l="findIndex",c=!0;l in[]&&Array(1)[l]((function(){c=!1})),r(r.P+r.F*c,"Array",{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),n(116)(l)},1129:function(e,t,n){"use strict";n(998)},1235:function(e,t,n){"use strict";n.r(t);n(13),n(254),n(25),n(39),n(1128),n(64),n(41);var head=n(715),r=n.n(head),o=n(714),l=n.n(o),c={name:"Shield",layout:"center_layout",mixins:[r.a,l.a],data:function(){return{title:this.$t("profile.myshield"),activeName:"all",shieldList:[],shieldTotal:0,pageNum:1,pageSize:10,loading:!1,loading2:!1,hasMore:!1,unbundlingArry:[],unbundUserData:[],shieldType:"",isSearch:!1,inputVal:"",time:null,userList:[],searchTotal:0}},computed:{userId:function(){return this.$store.getters["session/get"]("userId")}},mounted:function(){this.getShieldList(),this.getShieldData()},methods:{handleSizeChange:function(e){this.pageNum=1,this.pageSize=e,this.getShieldList()},handleCurrentChange:function(e){this.pageNum=e,this.getShieldList()},handleSizeChange2:function(e){this.pageNum=1,this.pageSize=e,this.getUserList(this.inputVal)},handleCurrentChange2:function(e){this.pageNum=e,this.getUserList(this.inputVal)},getShieldData:function(){var e=this;this.loading=!0,this.$store.dispatch("jv/get","users/".concat(this.userId,"/deny")).then((function(t){e.unbundUserData=[],e.unbundUserData.push(Number(e.userId)),t.forEach((function(n,i){e.unbundUserData.push(t[i].id)})),e.shieldTotal=t.length}),(function(t){return e.handleError(t)})).finally((function(){e.loading=!1}))},getShieldList:function(){var e=this;this.loading=!0;var t={"page[limit]":this.pageSize,"page[number]":this.pageNum};this.$store.dispatch("jv/get",["users/".concat(this.userId,"/deny"),{params:t}]).then((function(t){e.shieldList=t}),(function(t){return e.handleError(t)})).finally((function(){e.loading=!1}))},changeshield:function(e){var t=this;this.$confirm("是否解除屏蔽该用户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.unbundlingUser(e)})).catch((function(){t.$message({type:"info",message:"已取消解除屏蔽"})}))},unbundlingUser:function(e){var t=this;this.$store.dispatch("jv/delete","users/".concat(e,"/deny")).then((function(){t.unbundlingArry.push(e),t.$message.success(t.$t("profile.unboundsucceed")),t.getShieldList(),t.getShieldData()}))},addShield:function(){this.isSearch=!0,this.userList=[],this.searchTotal=0},onClickSearch:function(e){this.inputVal=e.target.value,this.unbundlingArry=[],this.userList=[],this.pageNum=1,this.getUserList(e.target.value)},searchinput:function(){this.userList=[],this.searchTotal=0},getUserList:function(e){var t=this;this.loading2=!0;var n={include:"groups",sort:"createdAt","page[number]":this.pageNum,"page[limit]":this.pageSize,"filter[username]":"*".concat(e,"*")};this.$store.dispatch("jv/get",["users",{params:n}]).then((function(e){var n=e;n.forEach((function(e,i){n[i].groupName=e.groups[0]?e.groups[0].name:""}));var data=n.filter((function(e){return-1===t.unbundUserData.indexOf(e.id)}));t.userList=data,t.searchTotal=n._jv.json.meta.total}),(function(e){return t.handleError(e)})).finally((function(){t.loading2=!1}))},shieldUser:function(e){var t=this;this.uid=e,this.$confirm("是否屏蔽该用户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.handleShield()})).catch((function(){t.$message({type:"info",message:"已取消屏蔽"})}))},handleShield:function(){var e=this,t={_jv:{type:"users/".concat(this.uid,"/deny")}};this.$store.dispatch("jv/post",t).then((function(){e.unbundlingID(e.uid)&&e.unbundlingArry.splice(e.unbundlingArry.findIndex((function(t){return t===e.uid})),1),e.inputVal="",e.pageNum=1,e.getUserList(""),e.getShieldData(),e.getShieldList(),e.isSearch=!1,e.$message.success(e.$t("profile.boundsucceed"))}))},unbundlingID:function(e){if(this.unbundlingArry&&this.unbundlingArry.includes(e))return!0}}},d=(n(1129),n(11)),component=Object(d.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"shield-container"},[e.shieldList.length>=0?n("div",[n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:e.isSearch?e.$t("profile.addshield"):e.$t("profile.myshield"),name:"all"}})],1),e._v(" "),e.isSearch?n("div",{staticClass:"shieldtop"},[n("div",{class:0===e.userList.length?"shieldnum hide":"shieldnum"},[e._v("\n        "+e._s(e.$t("manage.find"))+"\n        "),n("span",{staticClass:"searchusr"},[e._v('"'+e._s(e.inputVal)+'"')]),e._v("\n        "+e._s(e.$t("profile.searchresult"))+e._s(e.searchTotal)+e._s(e.$t("topic.item"))+"\n      ")]),e._v(" "),n("el-input",{staticClass:"shieldsearch",attrs:{autocomplete:"off",size:"small",placeholder:e.$t("invite.searchPlaceholder")},on:{input:e.searchinput},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onClickSearch.apply(null,arguments)}},model:{value:e.inputVal,callback:function(t){e.inputVal=t},expression:"inputVal"}},[n("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},on:{click:e.onClickSearch},slot:"suffix"})])],1):n("div",{staticClass:"shieldtop"},[n("div",{staticClass:"shieldnum"},[e._v("\n        "+e._s(e.$t("profile.totalshield"))+e._s(e.shieldTotal)+e._s(e.$t("profile.person"))+"\n      ")]),e._v(" "),n("el-button",{staticClass:"shieldbtn",attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.addShield}},[e._v(e._s(e.$t("profile.addshield")))])],1),e._v(" "),e.isSearch?e.searchTotal>0?n("div",{staticClass:"shieldtable"},[n("div",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading2,expression:"loading2"}],staticStyle:{width:"100%"},attrs:{data:e.userList}},[n("el-table-column",{attrs:{label:e.$t("manage.userName"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"flex"},[n("avatar",{attrs:{user:{id:t.row.id,username:t.row.username,avatarUrl:t.row.avatarUrl},size:30,round:!0}}),e._v(" "),n("nuxt-link",{staticClass:"user-name",attrs:{to:"/user/"+t.row.id}},[e._v(e._s(t.row.username))])],1)]}}],null,!1,712560739)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("manage.identity"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.groupName)+"\n            ")]}}],null,!1,3853133765)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("manage.operate"),width:"97"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticClass:"operabtn",attrs:{type:"text"},on:{click:function(n){return e.shieldUser(t.row.id)}}},[e._v(e._s(e.$t("profile.shield")))])]}}],null,!1,4135945611)})],1),e._v(" "),n("el-pagination",{staticClass:"pagination",attrs:{background:"","pager-count":5,"current-page":e.pageNum,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.searchTotal},on:{"size-change":e.handleSizeChange2,"current-change":e.handleCurrentChange2}})],1)]):[e.hasMore?n("div",{staticClass:"load-more",on:{click:e.loadMore}},[e._v(e._s(e.$t("topic.showMore")))]):n("div",{staticClass:"no-more"},[0===e.userList.length?n("svg-icon",{staticClass:"empty-icon",attrs:{type:"empty"}}):e._e(),e._v(e._s(e.userList.length>0?e.$t("discuzq.list.noMoreData"):e.$t("discuzq.list.noData"))+"\n      ")],1)]:n("div",{staticClass:"shieldtable"},[e.shieldTotal>0?n("div",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.shieldList}},[n("el-table-column",{attrs:{label:e.$t("manage.userName"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"flex"},[n("avatar",{attrs:{user:{id:t.row.id,username:t.row.username,avatarUrl:t.row.avatarUrl},size:30,round:!0}}),e._v(" "),n("nuxt-link",{staticClass:"user-name",attrs:{to:"/user/"+t.row.id}},[e._v(e._s(t.row.username))])],1)]}}],null,!1,712560739)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("manage.operate"),width:"97"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{staticClass:"operabtn",attrs:{type:"text"},on:{click:function(n){return e.changeshield(t.row.id)}}},[e._v(e._s(e.$t("profile.deleteshield")))])]}}],null,!1,3522184869)})],1),e._v(" "),n("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":e.pageNum,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.shieldTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):[e.hasMore?n("div",{staticClass:"load-more",on:{click:e.loadMore}},[e._v(e._s(e.$t("topic.showMore")))]):n("div",{staticClass:"no-more"},[0===e.shieldList.length?n("svg-icon",{staticClass:"empty-icon",attrs:{type:"empty"}}):e._e(),e._v(e._s(e.shieldList.length>0?e.$t("discuzq.list.noMoreData"):e.$t("discuzq.list.noshield"))+"\n        ")],1)]],2)],2):e._e()])}),[],!1,null,"763c1b2a",null);t.default=component.exports;installComponents(component,{Avatar:n(255).default,SvgIcon:n(62).default})},714:function(e,t,n){var r=n(726);n(31),n(52),e.exports={data:function(){var e=this;return{errorCodeHandler:{default:{model_not_found:function(){return e.$router.replace("/error")},not_authenticated:function(){return e.$router.push("/user/login")}},thread:{permission_denied:function(){return e.$router.replace("/error?code=permissionDenied")}}}}},methods:{handleError:function(e){var t=arguments,n=this;return r(regeneratorRuntime.mark((function r(){var o,l,c,d,h,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=t.length>1&&void 0!==t[1]?t[1]:"",l=e.response.data.errors,!(Array.isArray(l)&&l.length>0)){r.next=17;break}if(c=l[0].code,d=l[0].detail&&l[0].detail.length>0?l[0].detail[0]:l[0].code,h=l[0].detail&&l[0].detail.length>0?l[0].detail[0]:n.$t("core.".concat(d)),"site_closed"!==l[0].code){r.next=10;break}return r.next=9,n.siteClose(l);case 9:return r.abrupt("return",r.sent);case 10:if("need_ext_fields"!==l[0].code){r.next=14;break}return f=n.$store.getters["session/get"]("userId"),n.$router.push("/user/supple-mentary?id=".concat(f)),r.abrupt("return");case 14:"Permission Denied"===c?n.$message.error(n.$t("core.permission_denied2")):"content_banned_show_words"===c?n.$message.error(n.$t("core.content_banned_show_words")+l[0].detail):n.$message.error(h),n.errorCodeHandler.default[c]&&n.errorCodeHandler.default[c](),o&&n.errorCodeHandler[o][c]&&n.errorCodeHandler[o][c]();case 17:case"end":return r.stop()}}),r)})))()},siteClose:function(e){var t=this;return r(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.$store.dispatch("forum/setError",{code:e[0].code,detail:e[0].detail&&e[0].detail.length>0&&e[0].detail[0]});case 3:return n.next=5,t.$router.push("/site/close");case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(0);case 9:case"end":return n.stop()}}),n,null,[[0,7]])})))()}}}},715:function(e,t){e.exports={data:function(){return{title:"‎"}},computed:{forums:function(){return this.$store.state.site.info.attributes||{}}},head:function(){return{title:"‎"!==this.title&&this.forums&&this.forums.set_site&&this.forums.set_site.site_name?"".concat(this.title," - ").concat(this.forums.set_site.site_name):this.title}}}},726:function(e,t){function n(e,t,n,r,o,l,c){try{var d=e[l](c),h=d.value}catch(e){return void n(e)}d.done?t(h):Promise.resolve(h).then(r,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(o,l){var c=e.apply(t,r);function d(e){n(c,o,l,d,h,"next",e)}function h(e){n(c,o,l,d,h,"throw",e)}d(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},998:function(e,t,n){}}]);